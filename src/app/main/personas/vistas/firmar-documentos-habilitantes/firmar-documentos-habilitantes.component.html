<div class="content-wrapper">
    <div class="content-header row">
    </div>
    <div class="content-body">
        <!-- Error page-->
        <div class="misc-wrapper">

            <div class="card">
                <div class="card-body">

                    <div class=" mb-2 text-center">
                        <img src="/assets/images/logo/san-jose-v.png" width="300px">
                        <h2>
                            Firma de Documentos Habilitantes
                        </h2>
                        <br>
                        <p class="text-justify">
                            Para hacer uso de su Línea de Crédito debe firmar electrónicamente los documentos
                            habilitantes que se muestran a continuación. Para obtener una guía de ayuda, presione
                            en el siguiente <a [href]="['/personas/firmar-documentos']">ENLACE DE AYUDA</a>
                        </p>
                    </div>
                    <div class="content-body">
                        <!-- users list start -->
                        <section class="app-user-list">
                            <div class="box d-flex justify-content-center">
                                <div class="flex-basis text-center">
                                    <h4>
                                        Fecha del Documento
                                    </h4>
                                    <div>
                                        {{credito?.created_at | date: 'yyyy-mm-dd'}}
                                    </div>
                                </div>
                                <div class="flex-basis">
                                    <h4>
                                        Solicitud credito
                                    </h4>
                                    <div class="text-center">
                                        <a *ngIf="credito?.solicitudCredito && !credito?.solicitudCreditoFirmado"
                                           href="{{credito?.solicitudCredito}}"
                                           class="mr-1" target="_blank">Ver</a>
                                        <a *ngIf="credito?.solicitudCreditoFirmado"
                                           href="{{credito?.solicitudCreditoFirmado}}"
                                           class="mr-1"
                                           target="_blank">Ver</a>
                                        <br>
                                        <div
                                                class="badge badge-pill my-1"
                                                [ngClass]="credito?.solicitudCreditoFirmado ?'badge-light-success':'badge-light-warning' "
                                        >
                                                                                        <span *ngIf="credito?.solicitudCreditoFirmado"
                                                                                              [class]="'mr-50 m-1' "> Firmado</span>
                                            <span *ngIf="!credito?.solicitudCreditoFirmado"
                                                  [class]="'mr-50 m-1' "> Pendiente </span>
                                        </div>

                                        <div *ngIf="!credito?.solicitudCreditoFirmado">
                                            Firmar:  <i
                                                (click)="modalOpenSM(modalSM, credito,'solicitudCreditoFirmado')"
                                                ngbTooltip="Firmar"
                                                class="feather mx-50 font-medium-3"
                                                [ngClass]="'icon-check-square text-success'"
                                        ></i>
                                        </div>


                                    </div>
                                </div>
                                <div class="flex-basis text-center" style="width: 150px">
                                    <h4>
                                        Pagaré
                                    </h4>
                                    <div class="text-center">
                                        <a *ngIf="credito?.pagare && !credito?.pagareFirmado" href="{{credito?.pagare}}"
                                           target="_blank">Ver</a>
                                        <a *ngIf="credito?.pagareFirmado" href="{{credito?.pagareFirmado}}"
                                           target="_blank">Ver</a>
                                        <br>
                                        <div
                                                class="badge badge-pill my-1"
                                                [ngClass]="credito?.pagareFirmado ?'badge-light-success':'badge-light-warning' "
                                        >
                                                                                            <span *ngIf="credito?.pagareFirmado"
                                                                                                  [class]="'mr-50 m-1' "> Firmado</span>
                                            <span *ngIf="!credito?.pagareFirmado"
                                                  [class]="'mr-50 m-1' "> Pendiente </span>
                                        </div>

                                        <div *ngIf="!credito?.pagareFirmado">
                                            Firmar:  <i (click)="modalOpenSM(modalSM, credito,'pagareFirmado')"
                                                        ngbTooltip="Firmar"
                                                        class="feather mx-50 font-medium-3"
                                                        [ngClass]="'icon-check-square text-success'"
                                        ></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex-basis">
                                    <h4>
                                        Contratos cuenta
                                    </h4>
                                    <div class="text-center">
                                        <a *ngIf="credito?.contratosCuenta" href="{{credito?.contratosCuenta}}"
                                           target="_blank">Ver</a>
                                        <br>
                                        <div
                                                class="badge badge-pill my-1"
                                                [ngClass]="credito?.contratosCuentaFirmado ?'badge-light-success':'badge-light-warning' "
                                        >
                                                                                        <span *ngIf="credito?.contratosCuentaFirmado"
                                                                                              [class]="'mr-50 m-1' "> Firmado</span>
                                            <span *ngIf="!credito?.contratosCuentaFirmado"
                                                  [class]="'mr-50 m-1' "> Pendiente </span>
                                        </div>

                                        <div *ngIf="!credito?.contratosCuentaFirmado">
                                            Firmar:  <i
                                                (click)="modalOpenSM(modalSM, credito,'contratosCuentaFirmado')"
                                                ngbTooltip="Firmar"
                                                class="feather mx-50 font-medium-3"
                                                [ngClass]="'icon-check-square text-success'"
                                        ></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex-basis">
                                    <h4>
                                        Tabla amortización
                                    </h4>
                                    <div class="text-center">
                                        <a *ngIf="credito?.tablaAmortizacion" href="{{credito?.tablaAmortizacion}}"
                                           target="_blank">Ver</a>
                                        <br>
                                        <div
                                                class="badge badge-pill my-1"
                                                [ngClass]="credito?.tablaAmortizacionFirmado ?'badge-light-success':'badge-light-warning' "
                                        >
                                                                                        <span *ngIf="credito?.tablaAmortizacionFirmado"
                                                                                              [class]="'mr-50 m-1' "> Firmado</span>
                                            <span *ngIf="!credito?.tablaAmortizacionFirmado"
                                                  [class]="'mr-50 m-1' "> Pendiente </span>
                                        </div>

                                        <div *ngIf="!credito?.tablaAmortizacionFirmado">
                                            Firmar:  <i
                                                (click)="modalOpenSM(modalSM, credito,'tablaAmortizacionFirmado')"
                                                ngbTooltip="Firmar"
                                                class="feather mx-50 font-medium-3"
                                                [ngClass]="'icon-check-square text-success'"
                                        ></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="text-center justify-content-center m-2">
                                <button class="btn btn-primary" (click)="mostrarMensaje(mensajeAviso)">Continuar</button>
                            </div>
                        </section>
                        <!-- users list ends -->
                    </div>
                </div>
            </div>
        </div>


        <!-- / Error page-->
    </div>
</div>

<app-footer></app-footer>


<ng-template #modalSM let-modal>
    <div class="modal-header">
        <h5 class="modal-title" id="myModalLabel160">Firmar:</h5>
        <button type="button" class="close"
                (click)="modal.dismiss('Cross click')"
                aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" tabindex="0" ngbAutofocus>
        <form class="form form-horizontal "
              [formGroup]="documentoFirmaForm"
              (ngSubmit)="continuarCickPago()">
            <div class="form-group px-3 pt-3 pb-1 row">
                <label>Clave de la firma:</label>
                <input type="password" id="claveFirma"
                       class="form-control"
                       formControlName="claveFirma"
                       placeholder="Ingrese la clave de la Firma Electrónica"/>
                <div *ngIf="submitted && documentoFirmar.claveFirma.errors"
                     class="invalid-feedback"
                     style="display: block;">
                    <div *ngIf="documentoFirmar.claveFirma.errors.required">
                        Clave de la firma es requerido
                    </div>
                </div>
            </div>
            <div class="form-group px-3 py-0 row">
                <label for="customFile1">Firma electronica: </label>
                <div class="custom-file">
                    <input type="file" class="custom-file-input"
                           id="customFile1" required
                           formControlName="certificado"
                           (change)="subirImagen($event)"
                           accept=".p12"/>
                    <label class="custom-file-label"
                           for="customFile1">{{documentoFirmaForm.get('certificado').value}}</label>
                    <div *ngIf="submitted && documentoFirmar.certificado.errors"
                         class="invalid-feedback"
                         style="display: block;">
                        <div *ngIf="documentoFirmar.certificado.errors.required">
                            Firma electronica
                            requerido
                        </div>
                        <div *ngIf="documentoFirmar.certificado.errors.extensionInvalida">
                            La extension de la firma electronica es
                            incorrecta, suba un archivo (.p12)
                        </div>
                    </div>
                </div>
            </div>
            <!--                                                            <div class="mt-2 d-flex justify-content-center">-->
            <!--                                                                <button class="btn btn-primary mr-1" type="submit">-->
            <!--                                                                    Continuar-->
            <!--                                                                </button>-->
            <!--                                                            </div>-->
        </form>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary"
                    (click)="continuarCickPago()">Accept
            </button>
        </div>
    </div>
</ng-template>


<ng-template #mensajeModalConfirm let-modal>
    <div class="modal-header">
        <h5 class="modal-title" id="exampleModalCenterTitle">Validación de firma</h5>

        <button type="button" class="close" (click)="modal.dismiss('Cross click')" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" tabindex="0" ngbAutofocus>
        <div [innerHTML]="this.message"></div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-light" (click)="modal.dismiss('Cross click')">Aceptar</button>
    </div>
</ng-template>

<ng-template #mensajeAviso let-modal>
    <div class="modal-header">
        <button type="button" class="close" (click)="modal.dismiss('Cross click')" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" tabindex="0" ngbAutofocus>
        <div class="text-center">
            <h5>
                Los documentos firmados han sido enviados.
            </h5>
            <p>
                La Cooperativa de Ahorro y Crédito regulada validará la información y activará su acceso a la plataforma
                en las próximas horas.
            </p>
            <p>
                Lo mantendremos informado a través de su correo electrónico registrado {{usuario.email}}
            </p>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-light" (click)="modal.dismiss('Cross click')">Aceptar</button>
    </div>
</ng-template>
